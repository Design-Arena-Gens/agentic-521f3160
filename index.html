<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monkey Driver vs Confused Pedestrian</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #0a0a1a;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(to bottom, #1a1a3e 0%, #2d1b4e 50%, #1a0a2e 100%);
            cursor: pointer;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
        }

        .controls button {
            background: #ff6b9d;
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .controls button:hover {
            background: #ff8fb3;
        }

        .subtitle {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: #ffff00;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            min-width: 300px;
            display: none;
            animation: bounce 0.5s ease;
            border: 3px solid #ff6b9d;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
    </style>
</head>
<body>
    <div class="controls">
        <div><strong>üêµ Monkey Driver Adventure</strong></div>
        <div style="margin: 10px 0;">Click anywhere to replay the animation!</div>
        <button onclick="location.reload()">üîÑ Restart</button>
    </div>

    <div class="subtitle" id="subtitle"></div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const subtitle = document.getElementById('subtitle');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let animationFrame = 0;
        let scene = 'driving'; // driving, stopping, scolding
        let sceneTimer = 0;

        // Animation state
        let carX = -200;
        let humanX = canvas.width * 0.7;
        let humanWobble = 0;
        let monkeyArmWave = 0;
        let monkeyMouthOpen = false;
        let blinkTimer = 0;
        let monkeyEyesClosed = false;
        let humanEyesClosed = false;
        let exclamationMarks = [];
        let soundEffects = [];

        // Street lights
        const streetLights = [];
        for (let i = 0; i < 8; i++) {
            streetLights.push({
                x: i * (canvas.width / 7),
                flicker: Math.random() * Math.PI * 2
            });
        }

        // Buildings
        const buildings = [];
        for (let i = 0; i < 10; i++) {
            buildings.push({
                x: i * 200 - 100,
                height: 150 + Math.random() * 200,
                width: 120 + Math.random() * 80,
                windows: Math.floor(Math.random() * 20) + 10
            });
        }

        function drawNightSky() {
            // Stars
            ctx.fillStyle = 'white';
            for (let i = 0; i < 50; i++) {
                const x = (i * 123.456) % canvas.width;
                const y = (i * 78.9) % (canvas.height * 0.4);
                const twinkle = Math.sin(animationFrame * 0.05 + i) * 0.5 + 0.5;
                ctx.globalAlpha = twinkle;
                ctx.fillRect(x, y, 2, 2);
            }
            ctx.globalAlpha = 1;

            // Moon
            ctx.fillStyle = '#ffffcc';
            ctx.beginPath();
            ctx.arc(canvas.width - 150, 100, 50, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#f0f0b3';
            ctx.beginPath();
            ctx.arc(canvas.width - 140, 95, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(canvas.width - 155, 110, 10, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawBuildings() {
            buildings.forEach(building => {
                // Building body
                ctx.fillStyle = '#1a1a3a';
                ctx.fillRect(building.x, canvas.height - building.height - 150, building.width, building.height);

                // Windows
                ctx.fillStyle = '#ffeb3b';
                const rows = Math.floor(building.height / 40);
                const cols = Math.floor(building.width / 30);

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (Math.random() > 0.3) {
                            const wx = building.x + 10 + c * 30;
                            const wy = canvas.height - building.height - 140 + r * 40;
                            ctx.globalAlpha = 0.6 + Math.sin(animationFrame * 0.03 + c + r) * 0.2;
                            ctx.fillRect(wx, wy, 15, 20);
                        }
                    }
                }
                ctx.globalAlpha = 1;
            });
        }

        function drawRoad() {
            // Road
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, canvas.height - 150, canvas.width, 150);

            // Road markings
            ctx.strokeStyle = '#ffeb3b';
            ctx.lineWidth = 3;
            ctx.setLineDash([30, 20]);
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 75);
            ctx.lineTo(canvas.width, canvas.height - 75);
            ctx.stroke();
            ctx.setLineDash([]);

            // Sidewalk
            ctx.fillStyle = '#4a4a4a';
            ctx.fillRect(0, canvas.height - 150, canvas.width, 20);
        }

        function drawStreetLights() {
            streetLights.forEach((light, i) => {
                light.flicker += 0.1;

                // Pole
                ctx.fillStyle = '#3a3a3a';
                ctx.fillRect(light.x, canvas.height - 250, 8, 120);

                // Light fixture
                ctx.fillStyle = '#2a2a2a';
                ctx.fillRect(light.x - 15, canvas.height - 250, 40, 15);

                // Light glow
                const brightness = 0.8 + Math.sin(light.flicker) * 0.2;
                const gradient = ctx.createRadialGradient(light.x + 5, canvas.height - 240, 5, light.x + 5, canvas.height - 240, 80);
                gradient.addColorStop(0, `rgba(255, 235, 59, ${brightness})`);
                gradient.addColorStop(1, 'rgba(255, 235, 59, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(light.x - 70, canvas.height - 240, 150, 100);

                // Light bulb
                ctx.fillStyle = `rgba(255, 235, 59, ${brightness})`;
                ctx.beginPath();
                ctx.arc(light.x + 5, canvas.height - 243, 8, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawCar(x, y) {
            // Car shadow
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.ellipse(x + 60, y + 65, 70, 15, 0, 0, Math.PI * 2);
            ctx.fill();

            // Car body
            ctx.fillStyle = '#ff4757';
            ctx.beginPath();
            ctx.roundRect(x, y + 20, 140, 40, 10);
            ctx.fill();

            // Car top
            ctx.fillStyle = '#ff6b81';
            ctx.beginPath();
            ctx.roundRect(x + 20, y - 5, 90, 30, 15);
            ctx.fill();

            // Windows
            ctx.fillStyle = '#87ceeb';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.roundRect(x + 25, y, 35, 20, 8);
            ctx.fill();
            ctx.beginPath();
            ctx.roundRect(x + 75, y, 30, 20, 8);
            ctx.fill();
            ctx.globalAlpha = 1;

            // Wheels
            ctx.fillStyle = '#2a2a2a';
            ctx.beginPath();
            ctx.arc(x + 30, y + 60, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 110, y + 60, 15, 0, Math.PI * 2);
            ctx.fill();

            // Wheel rims
            ctx.fillStyle = '#6a6a6a';
            ctx.beginPath();
            ctx.arc(x + 30, y + 60, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 110, y + 60, 8, 0, Math.PI * 2);
            ctx.fill();

            // Headlights
            ctx.fillStyle = '#ffeb3b';
            ctx.fillRect(x + 135, y + 30, 8, 10);
            ctx.fillRect(x + 135, y + 45, 8, 10);

            // Headlight beams
            const beamGradient = ctx.createLinearGradient(x + 143, y + 35, x + 300, y + 35);
            beamGradient.addColorStop(0, 'rgba(255, 235, 59, 0.6)');
            beamGradient.addColorStop(1, 'rgba(255, 235, 59, 0)');
            ctx.fillStyle = beamGradient;
            ctx.beginPath();
            ctx.moveTo(x + 143, y + 25);
            ctx.lineTo(x + 280, y + 10);
            ctx.lineTo(x + 280, y + 60);
            ctx.lineTo(x + 143, y + 60);
            ctx.closePath();
            ctx.fill();

            // Tail lights
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(x - 3, y + 30, 5, 8);
            ctx.fillRect(x - 3, y + 47, 5, 8);
        }

        function drawMonkey(x, y, armAngle, mouthOpen, eyesClosed) {
            ctx.save();
            ctx.translate(x, y);

            // Leaning out animation
            if (scene === 'scolding') {
                ctx.translate(40, -10);
            }

            // Body
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.ellipse(0, 10, 18, 25, 0, 0, Math.PI * 2);
            ctx.fill();

            // Head
            ctx.fillStyle = '#a0522d';
            ctx.beginPath();
            ctx.arc(0, -15, 25, 0, Math.PI * 2);
            ctx.fill();

            // Face
            ctx.fillStyle = '#d2b48c';
            ctx.beginPath();
            ctx.ellipse(0, -10, 18, 15, 0, 0, Math.PI * 2);
            ctx.fill();

            // Ears
            ctx.fillStyle = '#a0522d';
            ctx.beginPath();
            ctx.arc(-20, -20, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(20, -20, 10, 0, Math.PI * 2);
            ctx.fill();

            // Inner ears
            ctx.fillStyle = '#d2b48c';
            ctx.beginPath();
            ctx.arc(-20, -20, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(20, -20, 6, 0, Math.PI * 2);
            ctx.fill();

            // Eyes
            ctx.fillStyle = 'white';
            if (!eyesClosed) {
                ctx.beginPath();
                ctx.ellipse(-10, -18, 6, 8, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(10, -18, 6, 8, 0, 0, Math.PI * 2);
                ctx.fill();

                // Pupils (angry eyes in scolding mode)
                ctx.fillStyle = 'black';
                const pupilX = scene === 'scolding' ? 2 : 0;
                ctx.beginPath();
                ctx.arc(-10 + pupilX, -17, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(10 + pupilX, -17, 4, 0, Math.PI * 2);
                ctx.fill();

                // Angry eyebrows
                if (scene === 'scolding') {
                    ctx.strokeStyle = 'black';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(-16, -25);
                    ctx.lineTo(-6, -23);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(16, -25);
                    ctx.lineTo(6, -23);
                    ctx.stroke();
                }
            } else {
                // Closed eyes
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(-10, -18, 6, 0, Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(10, -18, 6, 0, Math.PI);
                ctx.stroke();
            }

            // Nose
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.ellipse(0, -8, 4, 3, 0, 0, Math.PI * 2);
            ctx.fill();

            // Mouth
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 2;
            ctx.beginPath();
            if (mouthOpen) {
                ctx.ellipse(0, -2, 8, 6, 0, 0, Math.PI);
                ctx.fillStyle = '#ff6b9d';
                ctx.fill();
            } else {
                ctx.arc(0, -4, 8, 0, Math.PI);
            }
            ctx.stroke();

            // Arms
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 6;
            ctx.lineCap = 'round';

            // Left arm (waving in scolding mode)
            if (scene === 'scolding') {
                ctx.beginPath();
                ctx.moveTo(-15, 5);
                ctx.lineTo(-25 + Math.sin(armAngle) * 20, -20 + Math.cos(armAngle) * 15);
                ctx.stroke();

                // Hand
                ctx.fillStyle = '#a0522d';
                ctx.beginPath();
                ctx.arc(-25 + Math.sin(armAngle) * 20, -20 + Math.cos(armAngle) * 15, 5, 0, Math.PI * 2);
                ctx.fill();
            } else {
                ctx.beginPath();
                ctx.moveTo(-15, 5);
                ctx.lineTo(-25, 20);
                ctx.stroke();
            }

            // Right arm (on steering wheel)
            ctx.beginPath();
            ctx.moveTo(15, 5);
            ctx.lineTo(20, 20);
            ctx.stroke();

            ctx.restore();
        }

        function drawHuman(x, y, wobble, eyesClosed) {
            ctx.save();
            ctx.translate(x, y);

            // Wobble effect
            ctx.rotate(Math.sin(wobble) * 0.15);

            // Body
            ctx.fillStyle = '#4a90e2';
            ctx.fillRect(-15, -10, 30, 50);

            // Head
            ctx.fillStyle = '#ffdbac';
            ctx.beginPath();
            ctx.arc(0, -35, 20, 0, Math.PI * 2);
            ctx.fill();

            // Hair
            ctx.fillStyle = '#3a3a3a';
            ctx.beginPath();
            ctx.arc(0, -40, 20, Math.PI, Math.PI * 2);
            ctx.fill();
            ctx.fillRect(-20, -40, 40, 10);

            // Eyes (confused/dizzy)
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;

            if (!eyesClosed) {
                // Spiral dizzy eyes
                for (let i = 0; i < 2; i++) {
                    const eyeX = i === 0 ? -8 : 8;
                    ctx.beginPath();
                    for (let a = 0; a < Math.PI * 3; a += 0.1) {
                        const r = a * 1.5;
                        const px = eyeX + Math.cos(a) * r;
                        const py = -35 + Math.sin(a) * r;
                        if (a === 0) ctx.moveTo(px, py);
                        else ctx.lineTo(px, py);
                    }
                    ctx.stroke();
                }
            } else {
                ctx.beginPath();
                ctx.moveTo(-12, -35);
                ctx.lineTo(-4, -35);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(4, -35);
                ctx.lineTo(12, -35);
                ctx.stroke();
            }

            // Mouth (confused)
            ctx.beginPath();
            ctx.arc(0, -25, 5, 0, Math.PI);
            ctx.stroke();

            // Arms (swaying)
            ctx.strokeStyle = '#ffdbac';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(-15, 0);
            ctx.lineTo(-25 + Math.sin(wobble) * 10, 25);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(15, 0);
            ctx.lineTo(25 + Math.cos(wobble) * 10, 25);
            ctx.stroke();

            // Legs
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(-12, 40, 10, 30);
            ctx.fillRect(2, 40, 10, 30);

            // Shoes
            ctx.fillStyle = '#34495e';
            ctx.fillRect(-14, 70, 14, 8);
            ctx.fillRect(0, 70, 14, 8);

            // Confusion swirls
            if (scene === 'driving') {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 2;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.arc(-25 + i * 5, -60 + i * 5, 5 + i * 3, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            ctx.restore();
        }

        function drawExclamationMarks() {
            exclamationMarks.forEach((mark, index) => {
                mark.life--;
                mark.y -= 2;
                mark.scale = Math.max(0, mark.life / 30);

                ctx.save();
                ctx.globalAlpha = mark.scale;
                ctx.fillStyle = mark.color;
                ctx.font = 'bold 40px Arial';
                ctx.fillText('!', mark.x, mark.y);
                ctx.restore();

                if (mark.life <= 0) {
                    exclamationMarks.splice(index, 1);
                }
            });
        }

        function drawSoundEffect(text, x, y, color) {
            soundEffects.push({ text, x, y, color, life: 40, scale: 1 });
        }

        function drawSoundEffects() {
            soundEffects.forEach((effect, index) => {
                effect.life--;
                effect.y -= 1;
                effect.scale = Math.max(0, effect.life / 40);

                ctx.save();
                ctx.globalAlpha = effect.scale;
                ctx.fillStyle = effect.color;
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.font = 'bold 30px Comic Sans MS';
                ctx.strokeText(effect.text, effect.x, effect.y);
                ctx.fillText(effect.text, effect.x, effect.y);
                ctx.restore();

                if (effect.life <= 0) {
                    soundEffects.splice(index, 1);
                }
            });
        }

        function showSubtitle(text) {
            subtitle.textContent = text;
            subtitle.style.display = 'block';
            setTimeout(() => {
                subtitle.style.display = 'none';
            }, 3000);
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawNightSky();
            drawBuildings();
            drawRoad();
            drawStreetLights();

            sceneTimer++;

            // Scene 1: Driving
            if (scene === 'driving') {
                carX += 3;
                humanX -= 0.5;
                humanWobble += 0.1;

                if (carX > canvas.width * 0.4 && humanX < canvas.width * 0.5) {
                    scene = 'stopping';
                    sceneTimer = 0;
                    exclamationMarks.push({ x: carX + 50, y: canvas.height - 300, life: 30, scale: 1, color: '#ff0000' });
                    exclamationMarks.push({ x: carX + 70, y: canvas.height - 320, life: 30, scale: 1, color: '#ffff00' });
                    drawSoundEffect('SCREECH!', carX, canvas.height - 200, '#ff0000');
                    showSubtitle('üöóüí® *SCREECH!*');
                }
            }

            // Scene 2: Stopping
            else if (scene === 'stopping') {
                carX += Math.max(0, 3 - sceneTimer * 0.1);
                humanWobble += 0.15;

                if (sceneTimer > 30) {
                    scene = 'scolding';
                    sceneTimer = 0;
                    showSubtitle('üêµ "HEY! Watch where you\'re going, buddy!"');
                }
            }

            // Scene 3: Scolding
            else if (scene === 'scolding') {
                monkeyArmWave = animationFrame * 0.3;
                monkeyMouthOpen = Math.floor(animationFrame / 10) % 2 === 0;
                humanWobble += 0.08;

                // Add speech effects
                if (sceneTimer % 20 === 0) {
                    const phrases = ['OOK!', 'EEK!', 'WATCH IT!', 'HEY!'];
                    const phrase = phrases[Math.floor(Math.random() * phrases.length)];
                    drawSoundEffect(phrase, carX + 100, canvas.height - 280, '#ff6b9d');
                }

                if (sceneTimer === 60) {
                    showSubtitle('üòµ "Huh? What happened...?"');
                }

                if (sceneTimer > 120) {
                    showSubtitle('üêµ "This is why monkeys make better drivers!" üò§');
                }
            }

            // Blinking
            blinkTimer++;
            if (blinkTimer > 120) {
                monkeyEyesClosed = true;
                humanEyesClosed = true;
            }
            if (blinkTimer > 125) {
                monkeyEyesClosed = false;
                humanEyesClosed = false;
                blinkTimer = 0;
            }

            drawCar(carX, canvas.height - 140);
            drawMonkey(carX + 60, canvas.height - 120, monkeyArmWave, monkeyMouthOpen, monkeyEyesClosed);
            drawHuman(humanX, canvas.height - 150, humanWobble, humanEyesClosed);

            drawExclamationMarks();
            drawSoundEffects();

            animationFrame++;
            requestAnimationFrame(animate);
        }

        // Start animation
        animate();

        // Click to replay
        canvas.addEventListener('click', () => {
            carX = -200;
            humanX = canvas.width * 0.7;
            scene = 'driving';
            sceneTimer = 0;
            animationFrame = 0;
            exclamationMarks = [];
            soundEffects = [];
        });

        // Responsive resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
